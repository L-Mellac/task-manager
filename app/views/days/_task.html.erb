<div class="task"
      data-controller="task-update"
      data-task-update-task-id-value=<%= task.id %>
      data-action="mouseover->task-update#togglePopups mouseout->task-update#togglePopups">

  <div class="categories-menu hidden" data-task-update-target="categoriesPopup">
    <% categories.each do |category| %>

      <div class="category-btn-and-color-popup"
           data-controller="category-color"
           data-category-color-category-id-value=<%= category.id %>>
        <form action=<%="/tasks/#{task.id}"%> method="patch">
          <button type="submit" class="category-btn" name=task[category_id] value=<%= category.id %>
                  style="color: <%= category.color if category.color.present? %>"
                  data-action="mouseover->category-color#toggleColorPopup mouseout->category-color#toggleColorPopup"
                  data-category-color-target="categoryName">
                  <%= category.name %></button>
          <input type="hidden" name="authenticity_token", value="<%= form_authenticity_token %>">
        </form>

        <div class="category-color-popup hidden"
             data-category-color-target="colorSelectorPopup">
          <i class="fa-solid fa-palette category-color-btn"></i>
          <input type="color" name="category[color]" class="category-color-picker"
                  data-category-color-target="colorPickerInput"
                  data-action="change->category-color#submitColorChange">
        </div>
      </div>
    <% end %>
    <form action=<%="/tasks/#{task.id}"%> method="patch">
      <button type="submit" class="category-btn" name=task[category_id] value=<%= nil %>>(No Category)</button>
      <input type="hidden" name="authenticity_token", value="<%= form_authenticity_token %>">
    </form>
    <form action="/categories" method="post">
      <input type="text" placeholder="+ new category" name="category[name]">
      <input type="hidden" name="day" value="<%=day.id%>">
      <input type="hidden" name="authenticity_token", value="<%= form_authenticity_token %>">
    </form>
  </div>

  <form action=<%="/tasks/#{task.id}"%> method="patch">
    <div class="category" data-action="click->task-update#toggleCategoriesPopup" style="background-color: <%= task.category.color if task.category.present? && task.category.color.present? %>"><%= task.category.name.first unless task.category.nil? %></div>

    <input type="text" name="task[description]" value="<%=task.description%>">

    <button type="submit" name="task[completed]" class="checkmark <%= 'done' if task.completed? %>" value=<%= !task.completed? %>></button>

    <input type="hidden" name="authenticity_token", value="<%= form_authenticity_token %>">
  </form>

  <i class="fa-solid fa-circle-xmark delete-btn hidden"
      data-task-update-target="deleteButton"
      data-action="click->task-update#deleteTask"></i>

  <div class="update-priority-button">

    <i class="fa-solid fa-circle-exclamation hidden"
       data-task-update-target="priorityButton"
       data-action="click->task-update#togglePrioritySelector"></i>

    <div class="priority-options hidden"
         data-task-update-target="prioritySelector">
      <span data-action="click->task-update#updatePriority">1</span>
      <span data-action="click->task-update#updatePriority">2</span>
      <span data-action="click->task-update#updatePriority">3</span>
      <span data-action="click->task-update#updatePriority">4</span>
      <span data-action="click->task-update#updatePriority">5</span>
    </div>

  </div>
</div>
